<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>NeoRPG — Modern JS RPG</title>
  <style>
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;background:#0c0f1a;color:#d0d8e8;overflow:hidden;}
    #ui{position:absolute;top:10px;left:10px;right:10px;display:flex;justify-content:space-between;align-items:center;font-size:14px;}
    .bar{height:8px;background:#222;border-radius:4px;overflow:hidden;width:120px;}
    .fill{height:100%;border-radius:4px;transition:width 0.2s;}
    #hpbar .fill{background:#f43f5e;} #xpbar .fill{background:#22d3ee;}
    #log{position:absolute;bottom:10px;left:10px;background:rgba(0,0,0,0.5);padding:8px 10px;border-radius:8px;font-size:13px;max-width:360px;max-height:120px;overflow-y:auto;}
    button{background:#22d3ee;border:none;padding:6px 12px;border-radius:8px;color:#000;font-weight:600;cursor:pointer;}
    canvas{display:block;width:100%;height:100%;}
  </style>
</head>
<body>
  <canvas id="game"></canvas>
  <div id="ui">
    <div style="display:flex;align-items:center;gap:12px">
      <div>HP</div><div class="bar" id="hpbar"><div class="fill" style="width:100%"></div></div>
      <div>XP</div><div class="bar" id="xpbar"><div class="fill" style="width:0%"></div></div>
    </div>
    <button id="restart">Restart</button>
  </div>
  <div id="log"></div>
  <script>
  const canvas=document.getElementById('game');const ctx=canvas.getContext('2d');resize();window.addEventListener('resize',resize);
  const hpbar=document.querySelector('#hpbar .fill');const xpbar=document.querySelector('#xpbar .fill');const logEl=document.getElementById('log');const restart=document.getElementById('restart');
  let W=canvas.width,H=canvas.height;
  function resize(){canvas.width=innerWidth;canvas.height=innerHeight;W=canvas.width;H=canvas.height;}

  const TILE=48;const MAP_W=20,MAP_H=12;const keys={};window.addEventListener('keydown',e=>keys[e.key.toLowerCase()]=true);window.addEventListener('keyup',e=>keys[e.key.toLowerCase()]=false);

  const player={x:10,y:6,hp:100,maxHp:100,xp:0,lvl:1,atk:8,cool:0};const entities=[];let map=[];let running=false;let last=0;

  function makeMap(){map=[];for(let y=0;y<MAP_H;y++){const row=[];for(let x=0;x<MAP_W;x++){let t=0;if(x===0||y===0||x===MAP_W-1||y===MAP_H-1)t=1;else if(Math.random()<0.1)t=2;row.push(t);}map.push(row);}entities.length=0;for(let i=0;i<8;i++){let x=Math.floor(Math.random()*MAP_W),y=Math.floor(Math.random()*MAP_H);if(map[y][x]===0)entities.push({type:'enemy',x,y,hp:20});}}

  function start(){makeMap();player.x=10;player.y=6;player.hp=player.maxHp;player.xp=0;player.lvl=1;running=true;log('Welcome to NeoRPG!');requestAnimationFrame(loop);}
  restart.onclick=start;

  function loop(ts){if(!running)return;const dt=Math.min(0.05,(ts-last)/1000);last=ts;update(dt);draw();requestAnimationFrame(loop);}

  function update(dt){player.cool=Math.max(0,player.cool-dt);let dx=0,dy=0;if(keys['w']||keys['arrowup'])dy=-1;if(keys['s']||keys['arrowdown'])dy=1;if(keys['a']||keys['arrowleft'])dx=-1;if(keys['d']||keys['arrowright'])dx=1;if(dx||dy)movePlayer(dx,dy);if(keys[' '])attack();updateBars();}

  function movePlayer(dx,dy){const nx=player.x+dx,ny=player.y+dy;if(blocked(nx,ny))return;const e=entityAt(nx,ny);if(e){attackEntity(e);}else{player.x=nx;player.y=ny;}}
  function blocked(x,y){if(x<0||y<0||x>=MAP_W||y>=MAP_H)return true;return map[y][x]!==0;}
  function entityAt(x,y){return entities.find(e=>e.x===x&&e.y===y);}

  function attack(){if(player.cool>0)return;player.cool=0.3;const e=entities.find(en=>Math.abs(en.x-player.x)<=1&&Math.abs(en.y-player.y)<=1);if(e)attackEntity(e);}
  function attackEntity(e){const dmg=Math.floor(Math.random()*player.atk)+3;e.hp-=dmg;log('You hit an enemy for '+dmg);if(e.hp<=0){log('Enemy defeated!');entities.splice(entities.indexOf(e),1);gainXP(10);}else if(Math.random()<0.5){const edmg=Math.floor(Math.random()*5)+2;player.hp-=edmg;log('Enemy hits back for '+edmg);if(player.hp<=0){player.hp=0;log('You died!');running=false;}}}

  function gainXP(v){player.xp+=v;if(player.xp>=player.lvl*40){player.xp=0;player.lvl++;player.maxHp+=20;player.hp=player.maxHp;player.atk+=2;log('Level up! Lvl '+player.lvl);}updateBars();}

  function updateBars(){hpbar.style.width=(player.hp/player.maxHp*100)+'%';xpbar.style.width=(player.xp/(player.lvl*40)*100)+'%';}

  function draw(){ctx.fillStyle='#0a0d16';ctx.fillRect(0,0,W,H);const ox=(W-MAP_W*TILE)/2,oy=(H-MAP_H*TILE)/2;for(let y=0;y<MAP_H;y++){for(let x=0;x<MAP_W;x++){const t=map[y][x];ctx.fillStyle=t===0?'#1e293b':t===1?'#475569':'#14532d';ctx.fillRect(ox+x*TILE,oy+y*TILE,TILE-1,TILE-1);}}
    for(const e of entities){ctx.fillStyle='#ef4444';ctx.beginPath();ctx.arc(ox+e.x*TILE+TILE/2,oy+e.y*TILE+TILE/2,14,0,Math.PI*2);ctx.fill();}
    ctx.fillStyle='#22d3ee';ctx.beginPath();ctx.arc(ox+player.x*TILE+TILE/2,oy+player.y*TILE+TILE/2,16,0,Math.PI*2);ctx.fill();}

  const logs=[];function log(s){logs.unshift(s);if(logs.length>6)logs.pop();logEl.innerHTML=logs.map(l=>'• '+l).join('<br>');}
  start();
  </script>
</body>
</html>
